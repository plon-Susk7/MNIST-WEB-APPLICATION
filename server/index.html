<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MNIST Deployment</title>
    <script src="https://cdn.jsdelivr.net/gh/nicolaspanel/numjs@0.15.1/dist/numjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.5.2/dist/tf.min.js"></script>
</head>
<body>
    <h1>Hello World!</h1>
    <canvas id="myCanvas" width="280" height="280" style="border:1px solid #000000;">
    </canvas>
    <button id="clearBtn">Clear</button>
    <script>
        var canvas = document.getElementById('myCanvas');
        var clearBtn = document.getElementById('clearBtn')

        var context = canvas.getContext("2d");
        var isDrawing = false;

        // Event listener for mouse down event
        canvas.addEventListener("mousedown", startDrawing);

        // Event listener for mouse move event
        canvas.addEventListener("mousemove", draw);

        // Event listener for mouse up and mouse leave events

        canvas.addEventListener("mouseleave", stopDrawing);
        canvas.addEventListener("mouseup", ()=>{
            stopDrawing();
            var img = new Image();
            img.onload = function() {
                context.drawImage(img, 0, 0, 28, 28);
                data = context.getImageData(0, 0, 28, 28).data;
                var input = [];
                for(var i = 0; i < data.length; i += 4) {
                    input.push(data[i + 3] / 255);
                }
                predict(input)
            };
            img.src = canvas.toDataURL('image/png');
            
        });


        clearBtn.addEventListener("click",()=>{
            context.clearRect(0, 0, canvas.width, canvas.height);
        })

        function startDrawing(e) {
            isDrawing = true;
            var x = e.clientX - canvas.offsetLeft;
            var y = e.clientY - canvas.offsetTop;
            context.lineWidth = 10;
            context.beginPath();
            context.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;
            var x = e.clientX - canvas.offsetLeft;
            var y = e.clientY - canvas.offsetTop;
            context.lineTo(x, y);
            context.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        //Code generated by chatgpt :)

        tf.loadLayersModel('../model/model.json').then(model => {
            window.model = model;
        }).catch(err=>console.log(err))
        
        var predict = function(input) {
            
            window.model.predict([tf.tensor(input).reshape([1,28, 28, 1])]).array().then(function(scores){
            scores = scores[0];
            predicted = scores.indexOf(Math.max(...scores));
            console.log(predicted);
        });
            
    }

    </script>
</body>
<script src="script.js"></script>
</html>